#!/usr/bin/env python3
import subprocess
import re

ANSI_ESCAPE = re.compile(r'\x1B[@-_][0-?]*[ -/]*[@-~]')

def strip_ansi(text):
    return ANSI_ESCAPE.sub('', text)

def search_exploits(service, version):
    """
    Run Searchsploit with a service + version query.
    Strips ANSI escape sequences for clean output.
    """

    query = f"{service} {version}".strip()

    try:
        cmd = ["searchsploit", query]
        result = subprocess.run(cmd, capture_output=True, text=True)

        raw = result.stdout.strip()
        clean = strip_ansi(raw)

        if not clean:
            return f"[+] No exploits found for: {query}"

        return clean

    except FileNotFoundError:
        return "[!] searchsploit not found. Install with: sudo apt install exploitdb"

    except Exception as e:
        return f"[!] Searchsploit error: {e}"
